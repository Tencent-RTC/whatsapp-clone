"use strict";const t=12,e=20,s=23,o=27;class n{constructor(t=0,e=0){this.high=t,this.low=e}equal(t){return null!==t&&this.low===t.low&&this.high===t.high}toString(){var t=Number(this.high).toString(16);let e=Number(this.low).toString(16);if(e.length<8){let t=8-e.length;for(;t;)e="0"+e,t--}return t+e}}const i={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.18.188"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT:"wss://wssidn.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},r={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19},l="CHINA",a={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent(t=l){this.CURRENT=i.PRODUCTION[t]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},c={SEARCH_GRP_SNS:new n(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new n(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new n(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new n(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new n(0,Math.pow(2,6)).toString(),USER_STATUS:new n(0,Math.pow(2,7)).toString(),CONV_MARK:new n(0,Math.pow(2,9)).toString(),CONV_GROUP:new n(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new n(0,Math.pow(2,11)).toString(),MSG_EXT:new n(0,Math.pow(2,13)).toString(),GRP_COUNTER:new n(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new n(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new n(Math.pow(2,7)).toString(),PLUGIN_CS:new n(Math.pow(2,8)).toString(),PLUGIN_PUSH:new n(Math.pow(2,9)).toString(),PLUGIN_BOT:new n(Math.pow(2,10)).toString(),MSG_REACTION:new n(Math.pow(2,16)).toString(),FOLLOW:new n(Math.pow(2,20)).toString()},u=(a.HOST.setCurrent(l),"undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting)),h=(u&&wx.createGamePortal,"undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting)),_="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),g="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),f="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),m="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,w="undefined"!=typeof uni&&"undefined"==typeof window&&"function"==typeof uni.requireNativePlugin,d=u&&"object"==typeof wx.miniapp,p=u||h||_||g||f||w||m,T=("undefined"!=typeof uni||"undefined"!=typeof window)&&!p,I=(h?qq:_?tt:g?swan:f?my:u?wx:w?uni:m&&jd,T&&window&&window.navigator&&window.navigator.userAgent||""),L=/(micromessenger|webbrowser)/i.test(I),M=/AppleWebKit\/([\d.]+)/i.exec(I),y=(M&&parseFloat(M.pop()),function(){let t="WEB";return L?t="WEB":h?t="QQ_MP":_?t="TT_MP":g?t="BAIDU_MP":f?t="ALI_MP":u?t=d?"DONUT_NATIVE_APP":"WX_MP":w&&(t="UNI_NATIVE_APP"),r[t]}()),A=(!function(){var t=I.match(/OS (\d+)_/i);t&&t[1]&&t[1]}(),function(){var t,e,s=I.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);s&&(t=s[1]&&parseFloat(s[1]),e=s[2]&&parseFloat(s[2]),t&&e&&parseFloat(s[1]+"."+s[2]))}(),function(){var t=I.match(/Chrome\/(\d+)/);t&&t[1]&&parseFloat(t[1])}(),/MSIE/.test(I)||-1<I.indexOf("Trident")&&-1<I.indexOf("rv:11.0"));let S,E;!function(){var t=/MSIE\s(\d+)\.\d/.exec(I),t=t&&parseFloat(t[1]);!t&&/Trident\/7.0/i.test(I)&&/rv:11.0/.test(I)}(),function(){var t=I.match(/TBS\/(\d+)/i);t&&t[1]&&t[1]}(),S="undefined"!=typeof console?console:"undefined"!=typeof global&&global.console?global.console:"undefined"!=typeof window&&window.console?window.console:{};const U=function(){},O=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let F=O.length;for(;F--;)E=O[F],console[E]||(S[E]=U);var C=S;const P=function(){return(new Date).getTime()+0},D="Tag_Profile_IM_Nick",N="Tag_Profile_IM_Gender",v="Tag_Profile_IM_BirthDay",R="Tag_Profile_IM_Location",b="Tag_Profile_IM_SelfSignature",G="Tag_Profile_IM_AllowType",x="Tag_Profile_IM_Language",k="Tag_Profile_IM_Image",$="Tag_Profile_IM_MsgSettings",q="Tag_Profile_IM_AdminForbidType",B="Tag_Profile_IM_Level",W="Tag_Profile_IM_Role",j=Object.prototype.hasOwnProperty,H=function(t){return"map"===Q(t)},V=function(t){return"set"===Q(t)},K=function(t){return"file"===Q(t)},X=function(t){return null!==t&&("number"==typeof t&&!isNaN(+t)||"object"==typeof t&&t.constructor===Number)},Y=function(t){if("object"!=typeof t||null===t)return!1;t=Object.getPrototypeOf(t);if(null===t)return!0;let e=t;for(;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return t===e},z=function(t){return void 0===t},J=function(t){return e=t,("function"==typeof Array.isArray?Array.isArray(e):"array"===Q(e))||null!==t&&"object"==typeof t;var e},Q=function(t){return Object.prototype.toString.call(t).match(/^\[object (.*)\]$/)[1].toLowerCase()},Z=(Date.now||(Date.now=function(){return(new Date).getTime()}),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),et=Z.length;function st(){return!A&&!p}let ot=0;function nt(){return st()?"%c Chat %c":"Chat"}function it(){const t=function(){const t=new Date;return t.setTime(P()),t}();return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(t){let e;switch(t.toString().length){case 1:e="00"+t;break;case 2:e="0"+t;break;default:e=t}return e}(t.getMilliseconds())}const rt={arguments2String(s){let o="";if(1===s.length)o=s[0];else for(let t=0,e=s.length;t<e;t++)J(s[t])?s[t]instanceof Error?o+=(n=s[t],JSON.stringify(n,["message","code"])):o+=JSON.stringify(s[t]):o+=s[t],o+=" ";var n;return o},_exec(t,e){st()?C[t](nt(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",it(),e):C[t](`${nt()} ${it()} `+e)},d:function(){var t;ot<=-1&&(t=this.arguments2String(arguments),this._exec("debug",t))},l:function(){var t;ot<=0&&(t=this.arguments2String(arguments),this._exec("log",t))},log:function(){var t;ot<=0&&(t=this.arguments2String(arguments),this._exec("log",t))},i:function(){var t;ot<=1&&(t=this.arguments2String(arguments),this._exec("info",t))},w:function(){var t;ot<=2&&(t=this.arguments2String(arguments),this._exec("warn",t))},e:function(){var t;ot<=3&&(t=this.arguments2String(arguments),this._exec("error",t))},setLevel:function(t){t<4&&this._exec("log","set level from "+ot+" to "+t),ot=t},getLevel:function(){return ot}},lt=function(t){return{code:0,data:t||{}}};class at extends Error{constructor(t){super();var{code:t,message:e,data:s}=t;this.code=t,e?this.message=e:this._getErrMsg&&(this.message=this._getErrMsg(this.code)),this.data=s||{}}}const ct=2805,ut=2903,ht=3122,_t="onMyFollowersListUpdated",gt="onMyFollowingListUpdated",ft="onMutualFollowersListUpdated",mt="error";let wt=null;const dt=function(t){return Promise.resolve(lt(t))},pt=function(t,e=!1){if(t instanceof at)return e&&null!==wt&&wt.emit(mt,t),Promise.reject(t);if(t instanceof Error){const t=new at({code:ut});return e&&null!==wt&&wt.emit(mt,t),Promise.reject(t)}if(z(t)||z(t.code))return Promise.reject(new at({code:ut}));t=new at(t);return e&&null!==wt&&wt.emit(mt,t),Promise.reject(t)},Tt="follow_add",It="follow_delete",Lt="follow_get",Mt="follow_get_info",yt="follow_check",At={info:4,warning:5,error:6},St={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Et={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16};class Ut{constructor(t){this._n="SSOLogData",this.eventType=Et[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=P()}static bindEventStatModule(t){Ut.prototype._eventStatModule=t}static bindNetMonitorModule(t){Ut.prototype._netMonitorModule=t}updateTimeStamp(){this.timestamp=P()}start(t){return this._startts=t,this}end(t=!1){if(!this._sentFlag){if(this._netMonitorModule){const t=this._netMonitorModule.getNetworkType();this.setNetworkType(t)}var e=P();0===this.costTime&&(this.costTime=e-this._startts),this.setMoreMessage(`startts:${this._startts} endts:`+e),t?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(()=>{this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)},0)}}setError(t){if(!(t instanceof Error))return rt.w(this._n+".setError value not instanceof Error, please check!"),this;if(this._sentFlag)return this;let e=!0;if(e=this._netMonitorModule?this._netMonitorModule.isOnline():e)t.code&&this.setCode(t.code),t.message&&this.setMoreMessage(t.message);else{const t=ct;this.setCode(t)}return this.setLevel("error"),this}setCode(t){return z(t)||this._sentFlag||("ECONNABORTED"===t&&(this.code=103),X(t)?this.code=t:rt.w(this._n+".setCode value not a number, please check!",t,typeof t)),this}setMessage(t){return z(t)||this._sentFlag||(X(t)&&(this.message=t.toString()),"string"==typeof t&&(this.message=t)),this}setCostTime(t){return this.costTime=t,this}setLevel(t){return z(t)||this._sentFlag||(this.level=At[t]),this}setMoreMessage(t){return function(t){if(null==t)return 1;if("boolean"!=typeof t){if("number"==typeof t)return 0===t;if("string"==typeof t)return 0===t.length;if("function"==typeof t)return 0===t.length;if(Array.isArray(t))return 0===t.length;if(t instanceof Error)return""===t.message;if(Y(t)){for(const e in t)if(j.call(t,e))return;return 1}return(H(t)||V(t)||K(t))&&0===t.size}}(this.moreMessage)?this.moreMessage=""+t:this.moreMessage+=" "+t,this}setNetworkType(t){return z(t)?rt.w(this._n+".setNetworkType value is undefined, please check!"):(t=St[t.toLowerCase()],z(t)||(this.networkType=t)),this}getStartTs(){return this._startts}setUIPlatform(t){return this.uiPlatform=t,this}setExtension(t){return this.extension=t,this}setEventType(t){return this.eventType=t,this}}const Ot={A2KEY_AND_TINYID_UPDATED:"_inner1",CLOUD_CONFIG_UPDATED:"_inner2",PROFILE_UPDATED:"_inner3",CONV_SYNC_COMPLETED:"_inner4",C2C_UNREAD_HANDLE_COMPLETED:"_inner5"},Ft={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3};class Ct extends class{constructor(t){this._m=t,this._n=""}isLoggedIn(){return this._m.get(t).isLoggedIn()}isOversea(){return this._m.get(t).isOversea()}isPrivateNetWork(){return this._m.get(t).isPrivateNetWork()}getFileDownloadProxy(){return this._m.get(t).getFileDownloadProxy()}getMyUserID(){return this._m.get(t).getUserID()}getMyTinyID(){return this._m.get(t).getTinyID()}getSDKAppID(){return this._m.get(t).getSDKAppID()}isIntl(){return this._m.get(t).isIntl()}isUsingChatCore(){return this._m.get(t).isUsingChatCore()}isDevMode(){return this._m.get(t).isDevMode()}get(t){return this._m.get(t)}getPlatform(){return y}getCloudConfig(t){return this._m.get(s).getCloudConfig(t)}emitOEvt(t,e){this._m.getOEmitInst().emit(t,e)}emitIEvt(t,e){this._m.getIEmitInst().emit(t,e)}getIEmitInst(){return this._m.getIEmitInst()}generateTjgID(e){return this._m.get(t).getTinyID()+"-"+e.random}req(t){return this._m.get(e).req(t)}canIUse(t){return this._m.get(o).canIUse(t)}getErrMsg(t,e,s){return this._m.getErrMsg(t,e,s)}warn(t,e,s){t=this.getErrMsg(t,e,s);t&&rt.w(t)}noUse(t){var e=ht;return pt({code:e,message:this.getErrMsg(e,t)})}}{constructor(t){super(t),this._n="FollowModule",this._myFollowersList=new Map,this._myFollowingList=new Map,this._myMutualFollowersList=new Map,this._followType=new Map,this.MAX_CATCH_TIME=6e5,this.FIRST_PAGE_INDEX=function(){let e="";for(let t=32;0<t;--t)e+=Z[Math.floor(Math.random()*et)];return e}(),this.DEFAULT_COUNT=500,this.MAX_COUNT=1e3,this.getIEmitInst().on(Ot.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}_onCloudConfigUpdated(){var t=this.getCloudConfig("follow_req_count");z(t)||(t=Number(t),this.DEFAULT_COUNT=t>this.MAX_COUNT?this.MAX_COUNT:t,this._clearFollowList())}clearCacheOnReconnected(){this._clearFollowList(),this._followType.clear()}onFollowInfoNotify(t){var{followAddList:t=[],followDeleteList:e=[],pushType:s}=t.dataList||{},o=this._initFollowInfo();1===s?this._handleFollowAddList({followAddList:t,followInfo:o}):this._handleFollowDeleteList({followDeleteList:e,followInfo:o}),this._emitEvent(o),rt.l(`${this._n}.onFollowInfoNotify pushType:${s} followAddList:${t.length} followDeleteList:`+e.length)}_initFollowInfo(){const e={};return Object.values(Ft).forEach(t=>{t!==Ft.NONE&&(e[t]={userInfoList:[],isAdd:!1})}),e}_handleFollowAddList(t){const{followAddList:e,followInfo:o}=t;e.forEach(t=>{const{followTypeList:e=[],...s}=t;e.forEach(t=>{o[t].userInfoList.push(s),o[t].isAdd=!0}),this._setFollowType(t.userID,t.followType)})}_handleFollowDeleteList(t){const{followDeleteList:e,followInfo:o}=t;e.forEach(t=>{const{followTypeList:e=[],userID:s}=t;e.forEach(t=>{o[t].userInfoList.push(s),o[t].isAdd=!1}),this._setFollowType(t.userID,t.followType)})}_emitEvent(s){Object.keys(s).forEach(t=>{var t=Number(t),e=s[t];0<e.userInfoList.length&&(t===Ft.FOLLOWERS&&(this._clearFollowList(Ft.FOLLOWERS),this.emitOEvt(_t,e)),t===Ft.FOLLOWING&&(this._clearFollowList(Ft.FOLLOWING),this.emitOEvt(gt,e)),t===Ft.MUTUAL&&(this._clearFollowList(Ft.MUTUAL),this.emitOEvt(ft,e)))})}followUser(t){if(!this.canIUse(c.FOLLOW))return this.noUse("followUser");const e=this._n+".followUser",s="userIDList:"+t.length,o=new Ut("followUser");return o.setMessage(s),rt.l(e+" "+s),this.req({P:Tt,data:{fromAccount:this.getMyUserID(),userIDList:t.map(t=>({userID:t}))}}).then(t=>(o.end(),rt.l(e+" ok."),lt(t.data.resultList))).catch(t=>(o.setError(t).end(),rt.e(e+" failed. error:",t),pt(t)))}unfollowUser(t){if(!this.canIUse(c.FOLLOW))return this.noUse("unfollowUser");const e=this._n+".unfollowUser",s="userIDList:"+t.length,o=new Ut("unfollowUser");return o.setMessage(s),rt.l(e+" "+s),this.req({P:It,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then(t=>(o.end(),rt.l(e+" ok."),lt(t.data.resultList))).catch(t=>(o.setError(t).end(),rt.e(e+" failed. error:",t),pt(t)))}getMyFollowersList(e=""){const s="getMyFollowersList";if(!this.canIUse(c.FOLLOW))return this.noUse(s);const o=e||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(o)){var{resultList:t,nextCursor:n,lastUpdateTime:r}=this._myFollowersList.get(o);if(Date.now()-r<this.MAX_CATCH_TIME&&0<t.length)return rt.l(`${this._n}.${s} nextCursor:${e} from local.`),dt({resultList:t,nextCursor:n})}return this._getFollowList(e,Ft.FOLLOWERS).then(t=>(this._myFollowersList.set(o,{...t,lastUpdateTime:Date.now()}),rt.l(`${this._n}.${s} nextCursor:${e} from remote.`),lt(t)))}getMyFollowingList(e=""){const s="getMyFollowingList";if(!this.canIUse(c.FOLLOW))return this.noUse(s);const o=e||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(o)){var{resultList:t,nextCursor:n,lastUpdateTime:r}=this._myFollowingList.get(o);if(Date.now()-r<this.MAX_CATCH_TIME&&0<t.length)return rt.l(`${this._n}.${s} nextCursor:${e} from local.`),dt({resultList:t,nextCursor:n})}return this._getFollowList(e,Ft.FOLLOWING).then(t=>(this._myFollowingList.set(o,{...t,lastUpdateTime:Date.now()}),rt.l(`${this._n}.${s} nextCursor:${e} from remote.`),lt(t)))}getMutualFollowersList(e=""){const s="getMutualFollowersList";if(!this.canIUse(c.FOLLOW))return this.noUse(s);const o=e||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(o)){var{resultList:t,nextCursor:n,lastUpdateTime:r}=this._myMutualFollowersList.get(o);if(Date.now()-r<this.MAX_CATCH_TIME&&0<t.length)return rt.l(`${this._n}.${s} nextCursor:${e} from local.`),dt({resultList:t,nextCursor:n})}return this._getFollowList(e,Ft.MUTUAL).then(t=>(this._myMutualFollowersList.set(o,{...t,lastUpdateTime:Date.now()}),rt.l(`${this._n}.${s} nextCursor:${e} from remote.`),lt(t)))}_getFollowList(t,e){const n=new Ut("_getFollowList");return n.setMessage(`nextCursor:${t} type:`+e),this.req({P:Lt,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:t,type:e}}).then(t=>{n.end();const{resultList:e=[],nextCursor:s=""}=t.data,o=[];return e.forEach(t=>{var{userID:t,followTime:e,profileList:s=[]}=t;o.push({userID:t,followTime:e,...this._handleProfileItem(s)})}),{resultList:o,nextCursor:s}}).catch(t=>(n.setError(t).end(),rt.e(this._n+"._getFollowList failed. error:",t),pt(t)))}_handleProfileItem(t){const e={};return t.forEach(t=>{switch(t.tag){case D:e.nick=t.value;break;case N:e.gender=t.value;break;case v:e.birthday=t.value;break;case R:e.location=t.value;break;case b:e.selfSignature=t.value;break;case G:e.allowType=t.value;break;case x:e.language=t.value;break;case k:e.avatar=t.value;break;case $:e.messageSettings=t.value;break;case q:e.adminForbidType=t.value;break;case B:e.level=t.value;break;case W:e.role=t.value;break;default:e[t.tag]=t.value}}),e}getUserFollowInfo(t){if(!this.canIUse(c.FOLLOW))return this.noUse("getUserFollowInfo");let e=t,s=!1;z(t)&&(e=[this.getMyUserID()],s=!0);const n=this._n+".getUserFollowInfo",o=`userIDList:${e.length} isGetMyFollowInfo:`+s,r=new Ut("getUserFollowInfo");return r.setMessage(o),rt.l(n+" "+o),this.req({P:Mt,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then(t=>{r.end(),rt.l(n+" ok.");const{followInfoList:e=[]}=t.data,o=[];return e.forEach(t=>{var{followersCount:t,followingCount:e,mutualFollowersCount:s}=t;o.push({followersCount:t,followingCount:e,mutualFollowersCount:s})}),lt(o)}).catch(t=>(r.setError(t).end(),rt.e(n+" failed. error:",t),pt(t)))}checkFollowType(t){if(!this.canIUse(c.FOLLOW))return this.noUse("checkFollowType");100<t.length&&(t=t.slice(0,100),rt.w(s+" "+"the length of userIDList cannot exceed 100"));const s=this._n+".checkFollowType",e=`userIDList length:${t.length} `,o=new Ut("checkFollowType"),n=(o.setMessage(e),rt.l(s+" "+e),[]),r=[];return t.forEach(t=>{var e;this._followType.has(t)?(e=this._followType.get(t),n.push({userID:t,followType:e})):r.push(t)}),rt.l(`${s} from local count:${n.length}, from remote count:${r.length}.`),0===r.length?dt(n):this.req({P:yt,data:{fromAccount:this.getMyUserID(),userIDList:r}}).then(t=>{o.end(),rt.l(s+" ok.");const{resultList:e=[]}=t.data;return e.forEach(t=>{var{userID:t,followType:e}=t;this._setFollowType(t,e),n.push({userID:t,followType:e})}),lt(n)}).catch(t=>(o.setError(t).end(),rt.e(s+" failed. error:",t),pt(t)))}_setFollowType(t,e){this._followType.set(t,e)}_clearFollowList(t){if(z(t))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();t!==Ft.FOLLOWERS?t!==Ft.FOLLOWING?t!==Ft.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}reset(){rt.l(this._n+".reset"),this._clearFollowList(),this._followType.clear()}}export{Ct as default};